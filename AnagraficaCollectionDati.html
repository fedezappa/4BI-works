<!DOCTYPE html>
<html>
    <head>
        <title>Anagrafica con collection dati e oggetti</title>
    </head>
    <style>
        h1 {
            color: rgb(5, 5, 5);
            text-align: center;
            font-size: 23px;
            padding-top: 5px;
            padding-bottom: 15px;
            font-weight: bold;
        }
        body{
            font-family: 'Times New Roman', Times, serif;
            font-weight: lighter;
            font-size: 15px;
        }
    </style>
    <h1>Anagrafica con collection dati e oggetti</h1>
    <center>
        Inserisci il numero di persone da inserire
        <input type="text" id="personeDaInserire">
        <button onclick="generatore()" value="cliccami">cliccami</button>
    </center>
    
    <script>
        function controlloNomeECognome(str) {
            const regex = /^[a-zA-Z\s]+$/;
            return regex.test(str);
        }
        
        function controlloDataDiNascita(data) {
            const regex = /^\d{2}\/\d{2}\/\d{4}$/;
            return regex.test(data);
        }
        
        function controlloIndirizzo(indirizzo) {
            const regex = /^[a-zA-Z\s]+$/;
            return regex.test(indirizzo);
        }
        
        function controlloEmail(email) {
            const regex = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
            return regex.test(email);
        }
        
        function controlloPassword(password) {
            const regex = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[!@#$%^&*])[A-Za-z\d!@#$%^&*]{8,}$/;
            return regex.test(password);
        }
        
        function generatore() {
            let numero = parseInt(document.getElementById("personeDaInserire").value, 10);
            const dati = [];
        
            for (let i = 0; i < numero; i++) {
                let nome;
                do {
                    nome = prompt('inserisci il nome');
                    if (nome == null) {
                        alert('processo annullato');
                        return;
                    }
                    if (!controlloNomeECognome(nome)) {
                        alert('nome non valido');
                    }
                } while (!controlloNomeECognome(nome));
        
                dati.push(nome);
        
                let cognome;
                do {
                    cognome = prompt('inserisci il cognome');
                    if (cognome == null) {
                        alert('processo annullato');
                        return;
                    }
                    if (!controlloNomeECognome(cognome)) {
                        alert('cognome non valido');
                    }
                } while (!controlloNomeECognome(cognome));
        
                dati.push(cognome);
        
                let dataDiNascita;
                do {
                    dataDiNascita = prompt('inserisci la data di nascita nel formato dd/mm/yyyy');
                    if (dataDiNascita == null) {
                        alert('processo annullato');
                        return;
                    }
                    if (!controlloDataDiNascita(dataDiNascita)) {
                        alert('data di nascita non valida');
                    }
                } while (!controlloDataDiNascita(dataDiNascita));
        
                dati.push(dataDiNascita);
        
                let indirizzo;
                do {
                    indirizzo = prompt('inserisci la via e il numero civico separati da uno spazio');
                    if (indirizzo == null) {
                        alert('processo annullato');
                        return;
                    }
                } while (!indirizzo);
        
                dati.push(indirizzo);
        
                let email;
                do {
                    email = prompt('inserisci la mail');
                    if (email == null) {
                        alert('processo annullato');
                        return;
                    }
                    if (!controlloEmail(email)) {
                        alert('email non valida, inserisci un\'email corretta');
                    }
                } while (!controlloEmail(email));
        
                dati.push(email);
        
                let password;
                do {
                    password = prompt('inserisci la password');
                    if (password == null) {
                        alert('processo annullato');
                        return;
                    }
                    if (!controlloPassword(password)) {
                        alert('password non valida, deve avere almeno 8 caratteri, numeri, lettere e almeno un carattere speciale');
                    }
                } while (!controlloPassword(password));
        
                dati.push(password);
            }

            localStorage.setItem('datiAnagrafici', JSON.stringify(dati));
            location.href = 'risultato.html';
        }
    </script>            
</html>